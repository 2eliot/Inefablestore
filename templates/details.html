{% extends 'base.html' %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/store.css', v='3') }}">
{% endblock %}

{% block header %}
<header class="site-header">
  <div class="container">
    <div class="left-actions">
      <button class="icon-btn hamburger" aria-label="Men√∫">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>

    <a href="/" class="brand">
      {% if logo_url %}
        <img src="{{ logo_url }}" alt="{{ site_name|default('InefableStore') }}" class="logo"/>
      {% else %}
        <span class="logo-text">{{ site_name|default('InefableStore') }}</span>
      {% endif %}
    </a>
    <nav class="nav">
      <div class="nav-item dropdown" id="dd-cats">
        <button class="nav-link dd-toggle" type="button" aria-haspopup="true" aria-expanded="false">Categor√≠as ‚ñæ</button>
        <div class="dd-menu" role="menu" aria-label="Categor√≠as" hidden>
          <a href="#pkgs-gift" class="dd-item" data-cat="gift" role="menuitem">
            <span class="dd-icon" aria-hidden="true">üéÅ</span>
            <span>Gift Cards</span>
          </a>
          <a href="#pkgs-mobile" class="dd-item" data-cat="mobile" role="menuitem">
            <span class="dd-icon" aria-hidden="true">‚úàÔ∏è</span>
            <span>Juegos M√≥viles</span>
          </a>
          <a href="#" class="dd-item" data-cat="other" role="menuitem">
            <span class="dd-icon" aria-hidden="true">üë§</span>
            <span>Otros Servicios</span>
          </a>
        </div>
      </div>
    </nav>

    <div class="right-actions">
      <div class="header-search" role="search">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input id="header-search" type="search" placeholder="Buscar Juegos" autocomplete="off" />
      </div>
      <button class="icon-btn login" aria-label="Iniciar sesi√≥n">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      </button>
    </div>
  </div>
</header>
{% endblock %}

{% block content %}
<!-- Pay Modal moved here from header so header matches index -->
<div id="pay-modal" class="auth-modal" hidden>
  <div class="auth-card" style="max-width:720px;">
    <button class="icon-btn auth-close" data-close-pay aria-label="Cerrar">‚úï</button>
    <div class="auth-body">
      <div class="auth-title" id="pay-total-title">Total a pagar</div>
      <div class="card" style="background: rgba(2,6,23,0.6); color:#e5e7eb; border:1px solid rgba(148,163,184,0.30); border-radius:12px;">
        <div style="padding:12px 16px; font-weight:900;">Informaci√≥n de pago</div>
        <div id="pay-info" style="padding:0 16px 12px; display:grid; gap:10px;"></div>
      </div>
      <div class="card" style="background: rgba(2,6,23,0.6); color:#e5e7eb; border:1px solid rgba(148,163,184,0.30); border-radius:12px; margin-top:12px;">
        <div style="padding:12px 16px; font-weight:900;">Tiempo restante para completar el pago</div>
        <div id="pay-timer" style="padding:0 16px 12px; text-align:center; font-weight:800;">30:00</div>
        <div style="padding:0 16px 16px;">
          <input id="pay-ref" class="input" type="text" placeholder="Referencia (ej: √∫ltimos 6 d√≠gitos)">
          <button id="btn-confirm-pay" class="btn primary full" type="button">Confirmar Pago</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop"></div>
</div>

<section class="details-layout container" id="game-details" data-game-id="{{ game.id }}" data-category="{{ game.category }}" data-requires-zone="{{ 1 if game.requires_zone_id else 0 }}" data-active-login="{{ 1 if (active_login_game_id|int) == game.id else 0 }}" data-default-region="{{ player_lookup_region }}" data-scrape-enabled="{{ 1 if scrape_enabled else 0 }}">
  <div class="details-left">
    <div class="game-hero">
      <div class="banner" style="background-image:url('{{ game.image_path }}')"></div>
      <h1 class="game-title">{{ game.name }}</h1>
    </div>
    <div class="pill-row">
      <span class="pill">Pago seguro</span>
      <span class="pill">Cash back</span>
    </div>
    <p class="game-desc" id="game-desc">{{ game.description }}</p>
    <p id="game-special-desc" hidden>{{ game.special_description }}</p>
    <div class="selected-box" id="selected-box" hidden>
      <div class="selected-title" id="selected-title"></div>
      <div class="selected-price" id="selected-price"></div>
    </div>
  </div>
  <div class="details-right">
    
    <div class="step-card">
      <div class="step-title" data-step="1">Ingrese su ID</div>
      {% if scrape_enabled and active_login_game_id and (active_login_game_id|int) == game.id %}
      <div style="display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center;">
        <input id="customer-id" class="input" type="text" placeholder="Ingrese su ID">
        <button id="btn-verify-player" class="btn" type="button">Verificar</button>
      </div>
      {% else %}
      <input id="customer-id" class="input" type="text" placeholder="Ingrese su ID">
      {% endif %}
      {% if game.requires_zone_id %}
      <input id="customer-zone" class="input" type="text" placeholder="Ingresa tu Zona ID">
      {% endif %}
      {% if scrape_enabled and active_login_game_id and (active_login_game_id|int) == game.id %}
      <small id="player-nickname" class="ref-status" style="display:block; margin-top:6px; text-align:center;"></small>
      {% endif %}
    </div>

    <div class="step-card">
      <div class="step-title" data-step="2" style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
        <span>Selecciona tu producto</span>
        <button id="btn-leer" type="button" class="link" style="color:#22c55e; font-weight:800; text-decoration:underline; background:none; border:none; cursor:pointer; display:none;">Leer</button>
      </div>
      <div id="items-grid" class="items-grid"><!-- items --></div>
      <div style="margin-top:10px; text-align:center;">
        <button id="btn-more" class="btn" type="button" hidden>Ver m√°s</button>
      </div>
    </div>

    <div class="step-card">
      <div class="step-title" data-step="3">Seleccione un m√©todo de pago</div>
      <div class="pay-methods">
        <button id="pay-bsd" class="btn pay" type="button">Pago M√≥vil</button>
        <button id="pay-usd" class="btn pay" type="button">Binance</button>
      </div>
      <div class="summary">
        <span>Total</span>
        <strong id="summary-price">-</strong>
      </div>
    </div>

    <div class="step-card">
      <div class="step-title" data-step="4">Ingresa tus datos</div>
      <input id="email" class="input" type="email" placeholder="Correo de contacto">
      <div class="phone-field">
        <div class="phone-prefix">
          <button class="phone-cc-btn" type="button" aria-label="C√≥digo de pa√≠s">
            <img src="https://flagcdn.com/w20/ve.png" alt="VE" width="16" height="12" loading="lazy">
            <span id="phone-cc-label">+58</span>
            <span class="phone-caret" aria-hidden="true">‚ñæ</span>
          </button>
          <div class="phone-cc-menu" id="phone-cc-menu" hidden>
            <button type="button" data-cc="+58" data-flag="ve">üáªüá™ +58</button>
          </div>
          <input id="phone-cc" type="hidden" value="+58">
        </div>
        <input id="phone-local" class="input" type="tel" placeholder="N√∫mero de tel√©fono">
        <input id="phone" type="hidden" />
      </div>
      <div class="form-sep" aria-hidden="true"></div>
      <div class="discount-section" role="group" aria-label="C√≥digo de descuento">
        <input id="ref-code" class="input" type="text" placeholder="C√ìDIGO DE DESCUENTO (opcional)">
        <small id="ref-status" class="ref-status"></small>
      </div>
      <label class="check"><input id="save-data" type="checkbox"> Guardar datos para futuras compras</label>
      <button id="btn-buy" class="btn primary full" type="button">Comprar</button>
    </div>
  </div>
</section>
<div id="pkg-info-modal" class="auth-modal" hidden>
  <div class="auth-card" style="max-width:720px;">
    <button class="icon-btn auth-close" data-close-pkg-info aria-label="Cerrar">‚úï</button>
    <div class="auth-body">
      <div class="auth-title">Informaci√≥n del producto</div>
      <div class="card" style="background: rgba(2,6,23,0.6); color:#e5e7eb; border:1px solid rgba(148,163,184,0.30); border-radius:12px;">
        <div id="pkg-info-content" style="padding:12px 16px; white-space:pre-wrap;"></div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop"></div>
</div>
<!-- Footer m√≥vil: selecci√≥n actual -->
<div id="mfs" class="mobile-footer-sel" hidden aria-live="polite">
  <div class="mfs-icon" aria-hidden="true">üíé</div>
  <div class="mfs-mid">
    <div id="mfs-title" class="mfs-title">-</div>
    <div id="mfs-price" class="mfs-price"></div>
  </div>
  <div class="mfs-right" style="display:flex; flex-direction:column; align-items:center; gap:6px; margin:0 8px;">
    <button id="mfs-close" class="mfs-close" aria-label="Cerrar" title="Cerrar" style="line-height:1;">‚úï</button>
    <div class="mfs-qty" style="display:flex; align-items:center; gap:8px;">
      <button id="mfs-minus" class="btn" type="button" aria-label="Disminuir" title="-" style="min-width:36px; padding:6px 10px;">‚àí</button>
      <span id="mfs-qty-val" style="min-width:24px; text-align:center; font-weight:900;">1</span>
      <button id="mfs-plus" class="btn" type="button" aria-label="Aumentar" title="+" style="min-width:36px; padding:6px 10px;">+</button>
    </div>
  </div>
</div>
<!-- Overlay and Drawer + Auth modal copied so header buttons work here too -->
<div id="overlay" class="overlay" hidden></div>
<aside id="left-drawer" class="drawer left" hidden>
  <div class="drawer-header">
    <strong>Men√∫</strong>
    <button class="icon-btn close-left" aria-label="Cerrar">‚úï</button>
  </div>
  <nav class="drawer-nav" hidden></nav>
  <div class="drawer-section">
    <div class="drawer-title">Categor√≠as</div>
    <div class="drawer-list">
      <button class="drawer-item" type="button" data-cat="gift">Gift Cards</button>
      <button class="drawer-item" type="button" data-cat="mobile">Juegos M√≥viles</button>
    </div>
  </div>
</aside>

{% if related_packages %}
<section class="packages" id="related-packages">
  <div class="packages-head">
    <h2 class="packages-title">PAQUETES RELACIONADOS</h2>
  </div>
  <div class="packages-rail" aria-label="Carrusel de paquetes relacionados">
    {% for p in related_packages %}
      <a class="pkg-card" href="{{ url_for('store_game_detail', gid=p.id) }}">
        <div class="pkg-thumb" style="background-image:url('{{ p.image_path }}')"></div>
        <div class="pkg-name">{{ p.name }}</div>
      </a>
    {% endfor %}
  </div>
  
</section>
{% endif %}

<!-- Footer -->
<footer class="site-footer">
  <div class="footer-container">
    <!-- Left Section: Brand & Features -->
    <div class="footer-left">
      {% if logo_url %}
        <div class="footer-logo">
          <img src="{{ logo_url }}" alt="{{ site_name|default('InefableStore') }}" />
        </div>
      {% else %}
        <div class="footer-brand">
          <span class="brand-highlight">{{ site_name|default('INEFABLE')|upper }}</span><span class="brand-secondary">STORE</span>
        </div>
      {% endif %}
      <p class="footer-desc">Tu tienda de confianza para recargas de juegos, Gift Cards y productos digitales. Entrega inmediata y segura.</p>
      <div class="footer-features">
        <div class="feature-item">
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
          </svg>
          <span>Compra Segura</span>
        </div>
        <div class="feature-item">
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M13 10h5l-6 6-6-6h5V3h2v7zm-9 9h16v-5h2v6a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1v-6h2v5z"/>
          </svg>
          <span>Entrega R√°pida</span>
        </div>
        <div class="feature-item">
          <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
          </svg>
          <span>Soporte 24/7</span>
        </div>
      </div>
    </div>

    <!-- Right Section: Links & Social -->
    <div class="footer-right">
      <div class="footer-actions">
        <a href="/terms" class="footer-btn">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
          </svg>
          T√©rminos
        </a>
        <div class="footer-social">
          <a class="social-icon whatsapp" href="https://api.whatsapp.com/send?phone=%2B584125712917" target="_blank" rel="noopener" aria-label="WhatsApp" title="WhatsApp">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.52 3.48A11.77 11.77 0 0 0 12 0 11.9 11.9 0 0 0 .11 12.26a11.75 11.75 0 0 0 1.73 6.06L0 24l5.86-1.84a11.9 11.9 0 0 0 6.06 1.63h.01A11.89 11.89 0 0 0 24 12.02a11.8 11.8 0 0 0-3.48-8.54zM12 21.26h-.01a9.86 9.86 0 0 1-5.02-1.37l-.36-.21-3.47 1.09 1.14-3.38-.24-.35a9.83 9.83 0 0 1-1.52-5.26A9.9 9.9 0 0 1 12 2.02a9.85 9.85 0 0 1 9.9 9.9 9.86 9.86 0 0 1-9.9 9.34z"/><path d="M17.27 14.16c-.27-.14-1.6-.79-1.85-.87s-.43-.14-.61.14-.7.87-.86 1.05-.32.2-.59.07a8.06 8.06 0 0 1-2.36-1.45 8.8 8.8 0 0 1-1.63-2 .51.51 0 0 1 .11-.58c.1-.1.27-.32.41-.47a1.92 1.92 0 0 0 .27-.45.52.52 0 0 0 0-.5c0-.14-.61-1.47-.84-2s-.44-.45-.61-.46h-.52a1 1 0 0 0-.73.34 3.06 3.06 0 0 0-.95 2.27a5.32 5.32 0 0 0 1.12 2.84 12.16 12.16 0 0 0 4.64 4 15.86 15.86 0 0 0 1.58.58 3.8 3.8 0 0 0 1.76.11 2.87 2.87 0 0 0 1.89-1.33 2.36 2.36 0 0 0 .16-1.33c-.06-.11-.25-.18-.52-.32z"/></svg>
          </a>
          <a class="social-icon instagram" href="https://www.instagram.com/inefable_store_12/" target="_blank" rel="noopener" aria-label="Instagram" title="Instagram">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 0 1 12 7.5zm0 2A2.5 2.5 0 1 0 14.5 12 2.5 2.5 0 0 0 12 9.5zm5.25-3a1.25 1.25 0 1 1-1.25 1.25 1.25 1.25 0 0 1 1.25-1.25z"/></svg>
          </a>
          <a class="social-icon facebook" href="https://www.facebook.com/InefablestoreR/" target="_blank" rel="noopener" aria-label="Facebook" title="Facebook">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 12.06C22 6.51 17.52 2 12 2S2 6.51 2 12.06c0 5.01 3.66 9.16 8.44 9.94v-7.03H7.9v-2.9h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.23.2 2.23.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.77l-.44 2.9h-2.33v7.03C18.34 21.22 22 17.07 22 12.06z"/></svg>
          </a>
          <a class="social-icon tiktok" href="https://www.tiktok.com/@inefablestore" target="_blank" rel="noopener" aria-label="TikTok" title="TikTok">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
          </a>
        </div>
      </div>
      <div class="footer-copy">
        <p>¬© {{ now_ve().year }} {{ site_name|default('Inefablestore') }}</p>
        <p class="footer-rights">Todos los derechos reservados</p>
      </div>
    </div>
  </div>
</footer>

<div id="auth-modal" class="auth-modal" hidden>
  <div class="auth-card">
    <button class="icon-btn auth-close" aria-label="Cerrar">‚úï</button>
    <div class="tabs-auth" role="tablist">
      <button class="tab-auth active" data-target="#md-login" aria-selected="true">Iniciar sesi√≥n</button>
      <button class="tab-auth" data-target="#md-register" aria-selected="false">Registrarse</button>
    </div>
    <div class="auth-body">
      <div id="md-login" class="panel-auth active" role="tabpanel">
        <div class="auth-title">Iniciar sesi√≥n</div>
        <div class="alert" hidden></div>
        <form onsubmit="return false;" class="form-auth">
          <label>Email</label>
          <input type="email" placeholder="tu@correo.com">
          <label>Contrase√±a</label>
          <div class="password-field">
            <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button type="button" class="icon-eye" aria-label="Mostrar/Ocultar">üëÅÔ∏è</button>
          </div>
          <div class="helper-row">
            <a href="/reset-password" class="link">¬øOlvidaste tu contrase√±a?</a>
          </div>
          <button class="btn primary full" type="button">Iniciar sesi√≥n</button>
        </form>
      </div>
      <div id="md-register" class="panel-auth" role="tabpanel" hidden>
        <div class="auth-title">Crear cuenta</div>
        <div class="alert" hidden></div>
        <form onsubmit="return false;" class="form-auth">
          <label>Nombre</label>
          <input type="text" placeholder="Nombre">
          <label>Email</label>
          <input type="email" placeholder="tu@correo.com">
          <label>Tel√©fono</label>
          <input type="tel" placeholder="N√∫mero de tel√©fono">
          <label>Contrase√±a</label>
          <input type="password" placeholder="Crea una contrase√±a">
          <button class="btn primary full" type="button">Crear cuenta</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/store.js', v='3') }}" defer></script>
<script src="{{ url_for('static', filename='js/details.js', v='6') }}" defer></script>
{% endblock %}


